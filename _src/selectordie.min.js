!function (y) { "use strict"; var r = /\b(disabled|optgroup|no_results|is_placeholder)\b/; y.fn.selectOrDie = function (e) { var h, n, t = { multiSelect: !1, noFilterTimeout: !1, fuzzyFilter: !1, visualFilter: !1, customID: null, customClass: "", placeholder: null, placeholderOption: !1, prefix: null, cycle: !1, stripEmpty: !1, links: !1, linksExternal: !1, size: 0, tabIndex: 0, onChange: y.noop }, S = {}, u = !1, k = { initSoD: function (e) { return S = y.extend({}, t, e), this.each(function () { if (y(this).parent().hasClass("sod_select")) console.log("Select or Die: It looks like the SoD already exists"); else { var a, e, s, t = y(this), o = t.data("custom-id") ? t.data("custom-id") : S.customID, l = t.data("custom-class") ? t.data("custom-class") : S.customClass, i = t.data("prefix") ? t.data("prefix") : S.prefix, d = t.data("placeholder") ? t.data("placeholder") : S.placeholder, n = t.data("placeholder-option") ? t.data("placeholder-option") : S.placeholderOption, r = t.data("cycle") ? t.data("cycle") : S.cycle, c = t.data("links") ? t.data("links") : S.links, p = t.data("links-external") ? t.data("links-external") : S.linksExternal, h = parseInt(t.data("size")) ? t.data("size") : S.size, u = parseInt(t.data("tabindex")) ? t.data("tabindex") : S.tabIndex ? S.tabIndex : t.attr("tabindex") ? t.attr("tabindex") : S.tabIndex, f = t.data("strip-empty") ? t.data("strip-empty") : S.stripEmpty, b = t.prop("title") ? t.prop("title") : null, v = t.is(":disabled") ? " disabled" : "", m = !!t.data("visual-filter") || S.visualFilter, C = (!t.data("fuzzy-filter") && S.fuzzyFilter, !!t.prop("multiple") || S.multiSelect), _ = "", g = "", x = 0; i && (_ = '<span class="sod_prefix">' + i + "</span> "), g += d && !i ? '<span class="sod_label sod_placeholder">' + d + "</span>" : '<span class="sod_label">' + _ + "</span>", C && t.prop("multiple", !0), a = y("<span/>", { id: o, class: "sod_select " + l + v, title: b, tabindex: u, html: g, "data-cycle": r, "data-links": c, "data-links-external": p, "data-placeholder": d, "data-placeholder-option": n, "data-prefix": i, "data-filter": "" }).insertAfter(this), k.isTouch() && a.addClass("touch"), m && a.append(y("<div>", { class: "sod_filter_box_wrapper" }).append(y("<input>", { class: "sod_filter_box", type: "text" }))), e = y("<span/>", { class: "sod_list_wrapper" }).appendTo(a), s = y("<span/>", { class: "sod_list" }).appendTo(e), m && s.append(y("<span>", { class: "sod_option no_results hidden" }).text("No results!")), y("option, optgroup", t).each(function (e) { var t = y(this); f && !y.trim(t.text()) ? t.remove() : 0 === e && n && !_ ? k.populateSoD(t, s, a, !0) : k.populateSoD(t, s, a, !1) }), h && (e.show(), y(".sod_option:lt(" + h + ")", s).each(function () { x += y(this).outerHeight() }), e.removeAttr("style"), s.css({ "max-height": x })), t.appendTo(a), a.on("focusin", k.focusSod).on("click", k.triggerSod).on("click", ".sod_option", k.optionClick).on("mousemove", ".sod_option", k.optionHover).on("keydown", k.keyboardUse), t.on("change", k.selectChange), y(document).on("click", "label[for='" + t.attr("id") + "']", function (e) { e.preventDefault(), a.focus() }) } }) }, populateSoD: function (e, t, a, s) { var o = a.data("placeholder"), l = a.data("placeholder-option"), i = a.data("prefix"), d = a.find(".sod_label"), n = e.parent(), r = e.text(), c = e.val(), p = e.data("custom-id") ? e.data("custom-id") : null, h = e.data("custom-class") ? e.data("custom-class") : "", u = e.is(":disabled") ? " disabled " : "", f = e.is(":selected") ? " selected active " : "", b = e.data("link") ? " link " : "", v = e.data("link-external") ? " linkexternal" : "", m = e.prop("label"); e.is("option") ? (y("<span/>", { class: "sod_option " + h + u + f + b + v, id: p, title: r, html: r, "data-value": c }).appendTo(t), s && !i ? (a.data("label", r), a.data("placeholder", r), e.prop("disabled", !0), t.find(".sod_option:last").addClass("is_placeholder disabled"), f && d.addClass("sod_placeholder")) : f && o && !l && !i ? a.data("label", o) : f && a.data("label", r), (f && !o || f && l || f && i) && d.append(r), n.is("optgroup") && (t.find(".sod_option:last").addClass("groupchild"), n.is(":disabled") && t.find(".sod_option:last").addClass("disabled"))) : y("<span/>", { class: "sod_option optgroup " + u, title: m, html: m, "data-label": m }).appendTo(t) }, focusSod: function () { var e = y(this); e.hasClass("disabled") ? k.blurSod(e) : (k.blurSod(y(".sod_select.focus").not(e)), e.addClass("focus"), y("html").on("click.sodBlur", function () { k.blurSod(e) })) }, triggerSod: function (e) { e.stopPropagation(); var t = y(this), a = t.find(".sod_list"), s = t.data("placeholder"), o = t.find(".active"), l = t.find(".selected"); t.hasClass("disabled") || t.hasClass("open") || t.hasClass("touch") ? (clearTimeout(n), k.closeSod(t), s && (t.find(".sod_label").get(0).lastChild.nodeValue = o.text())) : (t.addClass("open"), s && !t.data("prefix") && t.find(".sod_label").addClass("sod_placeholder").html(s), k.listScroll(a, l.first()), k.checkViewport(t, a)) }, keyboardUse: function (e) { var t, a, s, o = y(this), l = o.find(".sod_list"), i = o.find(".sod_option"), d = o.find(".sod_label"), n = o.data("cycle"), r = i.filter(".active"), c = ":not('.disabled, .optgroup, .is_placeholder, .no_results, .hidden')"; if (36 < e.which && e.which < 41) return 37 === e.which || 38 === e.which ? (a = r.prevAll(c).first(), s = i.not(c).last()) : 39 !== e.which && 40 !== e.which || (a = r.nextAll(c).first(), s = i.not(c).first()), !a.hasClass("sod_option") && n && (a = s), (a.hasClass("sod_option") || n) && (r.removeClass("active"), a.addClass("active"), d.get(0).lastChild.nodeValue = a.text(), k.listScroll(l, a), o.hasClass("open") || (u = !0), o.addClass("open")), !1; if (13 === e.which || 32 === e.which && o.hasClass("open") && (" " === o.data("filter")[0] || "" === o.data("filter")) ? (e.preventDefault(), r.click()) : 32 !== e.which || o.hasClass("open") || " " !== o.data("filter")[0] && "" !== o.data("filter") ? 27 === e.which && k.blurSod(o) : (e.preventDefault(), u = !1, o.click()), !(e.ctrlKey || e.shiftKey || e.metaKey || e.altKey) && e.char) { if (0 !== e.which) { clearTimeout(h); var p = o.data("filter"); 8 == e.which ? p = p.substring(0, (p.length || 1) - 1) : p += String.fromCharCode(e.which).toUpperCase(), p = y.trim(p), o.data("filter", p).find(".sod_filter_box").val(p), console.log("Filter str is ", p), (t = i.filter(function () { var e, t = y(this).text().toUpperCase().indexOf(p); return e = !p || !p.match(/\w/i) || (S.fuzzyFilter ? -1 !== t : 0 === t), S.visualFilter && y(this).hasClass("hidden") === e && y(this)[(e ? "remove" : "add") + "Class"]("hidden"), e }).not(c)).length && (r.removeClass("active"), t.first().addClass("active"), k.listScroll(l, t), d.get(0).lastChild.nodeValue = k.getOptionsString(t), o.hasClass("open") || (u = !0)), o.find(".no_results")[(t.length ? "add" : "remove") + "Class"]("hidden"), S.noFilterTimeout || (h = setTimeout(function () { o.data("filter", "") }, 500)) } return e.stopPropagation(), e.preventDefault(), !1 } }, optionHover: function () { var e = y(this); e[0].className.match(r) || e.siblings().removeClass("active").end().addClass("active") }, getOptionsString: function (e) { return 1 < e.length && (e = e.not(":disabled").not(".disabled"), S.multiSelect || (e = e.first())), y.map(e, function (e) { return y(e).text() }).join(", ") }, optionClick: function (e) { e.stopPropagation(); var t = y(this), a = t.closest(".sod_select"), s = r.test(this.className), o = a.find(".sod_option").filter(function () { return !r.test(this.className) }).index(this); if (!a.hasClass("touch")) { if (!s) { a.find(".sod_placeholder").removeClass("sod_placeholder"); var l = a.find(".selected").not(t), i = y(a.find("select option")[o]), d = i.prop("selected"); S.multiSelect || !l.length || d || (l.removeClass("selected"), l = []), !S.multiSelect && (l.length || d) || (i.prop("selected", !d), t[(d ? "remove" : "add") + "Class"]("selected")), a.find("select").change() } clearTimeout(n), S.multiSelect || k.closeSod(a) } }, selectChange: function () { var e = y(this), t = e.find(":selected"), a = k.getOptionsString(t), s = e.closest(".sod_select"), o = s.data("placeholder"); s.find(".sod_label").get(0).lastChild.nodeValue = a || o, s.data("label", a), S.onChange.call(this), !s.data("links") && !t.data("link") || t.data("link-external") ? (s.data("links-external") || t.data("link-external")) && t.each(function () { window.open(y(this).val(), "_blank") }) : window.location.href = t.first().val() }, blurSod: function (e) { if (y("body").find(e).length) { var t = e.data("label"), a = e.data("placeholder"), s = e.find(".active"), o = e.find(".selected"), l = !1; clearTimeout(n), u && !s.hasClass("selected") ? (s.click(), l = !0) : s.hasClass("selected") || (s.removeClass("active"), o.addClass("active")); var i = k.getOptionsString(o); l && !o.length || !a ? l || (e.find(".sod_label").get(0).lastChild.nodeValue = t) : e.find(".sod_label").get(0).lastChild.nodeValue = i || a, u = !1, e.removeClass("focus"), k.closeSod(e), e.blur(), y("html").off(".sodBlur") } }, closeSod: function (e) { e.removeClass("open").data("filter", "").each(function () { y(this).find(".sod_option.hidden").removeClass("hidden") }).each(function () { y(this).find(".sod_option.no_results").addClass("hidden") }).each(function () { y(this).find(".sod_filter_box").val("") }) }, checkViewport: function (e, t) { var a = e[0].getBoundingClientRect(), s = t.outerHeight(); a.bottom + s + 10 > y(window).height() && 10 < a.top - s ? e.addClass("above") : e.removeClass("above"), n = setTimeout(function () { k.checkViewport(e, t) }, 200) }, listScroll: function (e, t) { var a = e[0].getBoundingClientRect(), s = t[0].getBoundingClientRect(); a.top > s.top ? e.scrollTop(e.scrollTop() - a.top + s.top) : a.bottom < s.bottom && e.scrollTop(e.scrollTop() - a.bottom + s.bottom) }, isTouch: function () { return "ontouchstart" in window || 0 < navigator.MaxTouchPoints || 0 < navigator.msMaxTouchPoints } }, a = { destroy: function () { return this.each(function () { var e = y(this), t = e.parent(); t.hasClass("sod_select") ? (e.off("change"), t.find("span").remove(), e.unwrap()) : console.log("Select or Die: There's no SoD to destroy") }) }, update: function () { return this.each(function () { var e = y(this), t = e.parent(), a = t.find(".sod_list:first"); t.hasClass("sod_select") ? (a.empty(), t.find(".sod_label").get(0).lastChild.nodeValue = "", e.is(":disabled") && t.addClass("disabled"), y("option, optgroup", e).each(function () { k.populateSoD(y(this), a, t) })) : console.log("Select or Die: There's no SoD to update") }) }, disable: function (a) { return this.each(function () { var e = y(this), t = e.parent(); t.hasClass("sod_select") ? void 0 !== a ? (t.find(".sod_list:first .sod_option[data-value='" + a + "']").addClass("disabled"), t.find(".sod_list:first .sod_option[data-label='" + a + "']").nextUntil(":not(.groupchild)").addClass("disabled"), y("option[value='" + a + "'], optgroup[label='" + a + "']", this).prop("disabled", !0)) : t.hasClass("sod_select") && (t.addClass("disabled"), e.prop("disabled", !0)) : console.log("Select or Die: There's no SoD to disable") }) }, enable: function (a) { return this.each(function () { var e = y(this), t = e.parent(); t.hasClass("sod_select") ? void 0 !== a ? (t.find(".sod_list:first .sod_option[data-value='" + a + "']").removeClass("disabled"), t.find(".sod_list:first .sod_option[data-label='" + a + "']").nextUntil(":not(.groupchild)").removeClass("disabled"), y("option[value='" + a + "'], optgroup[label='" + a + "']", this).prop("disabled", !1)) : t.hasClass("sod_select") && (t.removeClass("disabled"), e.prop("disabled", !1)) : console.log("Select or Die: There's no SoD to enable") }) } }; return a[e] ? a[e].apply(this, Array.prototype.slice.call(arguments, 1)) : "object" != typeof e && e ? void y.error('Select or Die: Oh no! No such method "' + e + '" for the SoD instance') : k.initSoD.apply(this, arguments) } }(jQuery);