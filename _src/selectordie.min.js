!function($){"use strict";$.fn.selectOrDie=function(method){var $defaults={multiSelect:!1,noFilterTimeout:!1,fuzzyFilter:!1,visualFilter:!1,customID:null,customClass:"",placeholder:null,placeholderOption:!1,prefix:null,cycle:!1,stripEmpty:!1,links:!1,linksExternal:!1,size:0,tabIndex:0,onChange:$.noop},$_settings={},$_sodKeysWhenClosed=!1,$_sodFilterTimeout,$_sodViewportTimeout,_private={initSoD:function(options){return $_settings=$.extend({},$defaults,options),this.each(function(){if($(this).parent().hasClass("sod_select"))console.log("Select or Die: It looks like the SoD already exists");else{var $select=$(this),$settingsId=$select.data("custom-id")?$select.data("custom-id"):$_settings.customID,$settingsClass=$select.data("custom-class")?$select.data("custom-class"):$_settings.customClass,$settingsPrefix=$select.data("prefix")?$select.data("prefix"):$_settings.prefix,$settingsPlaceholder=$select.data("placeholder")?$select.data("placeholder"):$_settings.placeholder,$settingsPlaceholderOption=$select.data("placeholder-option")?$select.data("placeholder-option"):$_settings.placeholderOption,$settingsCycle=$select.data("cycle")?$select.data("cycle"):$_settings.cycle,$settingsLinks=$select.data("links")?$select.data("links"):$_settings.links,$settingsLinksExternal=$select.data("links-external")?$select.data("links-external"):$_settings.linksExternal,$settingsSize=parseInt($select.data("size"))?$select.data("size"):$_settings.size,$settingsTabIndex=parseInt($select.data("tabindex"))?$select.data("tabindex"):$_settings.tabIndex?$_settings.tabIndex:$select.attr("tabindex")?$select.attr("tabindex"):$_settings.tabIndex,$settingsStripEmpty=$select.data("strip-empty")?$select.data("strip-empty"):$_settings.stripEmpty,$selectTitle=$select.prop("title")?$select.prop("title"):null,$selectDisabled=$select.is(":disabled")?" disabled":"",$visualFilter=!!$select.data("visual-filter")||$_settings.visualFilter,$fuzzyFilter=!!$select.data("fuzzy-filter")||$_settings.fuzzyFilter,$multiSelect=!!$select.prop("multiple")||$_settings.multiSelect,$sodPrefix="",$sodHtml="",$sodHeight=0,$sod,$sodListWrapper,$sodList;$settingsPrefix&&($sodPrefix='<span class="sod_prefix">'+$settingsPrefix+"</span> "),$sodHtml+=$settingsPlaceholder&&!$settingsPrefix?'<span class="sod_label sod_placeholder">'+$settingsPlaceholder+"</span>":'<span class="sod_label">'+$sodPrefix+"</span>",$multiSelect&&$select.prop("multiple",!0),$sod=$("<span/>",{id:$settingsId,class:"sod_select "+$settingsClass+$selectDisabled,title:$selectTitle,tabindex:$settingsTabIndex,html:$sodHtml,"data-cycle":$settingsCycle,"data-links":$settingsLinks,"data-links-external":$settingsLinksExternal,"data-placeholder":$settingsPlaceholder,"data-placeholder-option":$settingsPlaceholderOption,"data-prefix":$settingsPrefix,"data-filter":""}).insertAfter(this),_private.isTouch()&&$sod.addClass("touch"),$visualFilter&&$sod.append($("<div>",{class:"sod_filter_box_wrapper"}).append($("<input>",{class:"sod_filter_box",type:"text",disabled:"disabled"}))),$sodListWrapper=$("<span/>",{class:"sod_list_wrapper"}).appendTo($sod),$sodList=$("<span/>",{class:"sod_list"}).appendTo($sodListWrapper),$visualFilter&&$sodList.append($("<span>",{class:"sod_option no_results hidden"}).text("No results!")),$("option, optgroup",$select).each(function(i){var $this=$(this);$settingsStripEmpty&&!$.trim($this.text())?$this.remove():0===i&&$settingsPlaceholderOption&&!$sodPrefix?_private.populateSoD($this,$sodList,$sod,!0):_private.populateSoD($this,$sodList,$sod,!1)}),$settingsSize&&($sodListWrapper.show(),$(".sod_option:lt("+$settingsSize+")",$sodList).each(function(){$sodHeight+=$(this).outerHeight()}),$sodListWrapper.removeAttr("style"),$sodList.css({"max-height":$sodHeight})),$select.appendTo($sod),$sod.on("focusin",_private.focusSod).on("click",_private.triggerSod).on("click",".sod_option",_private.optionClick).on("mousemove",".sod_option",_private.optionHover).on("keydown",_private.keyboardUse),$select.on("change",_private.selectChange),$(document).on("click","label[for='"+$select.attr("id")+"']",function(e){e.preventDefault(),$sod.focus()})}})},populateSoD:function($option,$sodList,$sod,$isPlaceholder){var $sodPlaceholder=$sod.data("placeholder"),$sodPlaceholderOption=$sod.data("placeholder-option"),$sodPrefix=$sod.data("prefix"),$sodLabel=$sod.find(".sod_label"),$optionParent=$option.parent(),$optionText=$option.text(),$optionValue=$option.val(),$optionCustomId=$option.data("custom-id")?$option.data("custom-id"):null,$optionCustomClass=$option.data("custom-class")?$option.data("custom-class"):"",$optionIsDisabled=$option.is(":disabled")?" disabled ":"",$optionIsSelected=$option.is(":selected")?" selected active ":"",$optionLink=$option.data("link")?" link ":"",$optionLinkExternal=$option.data("link-external")?" linkexternal":"",$optgroupLabel=$option.prop("label");$option.is("option")?($("<span/>",{class:"sod_option "+$optionCustomClass+$optionIsDisabled+$optionIsSelected+$optionLink+$optionLinkExternal,id:$optionCustomId,title:$optionText,html:$optionText,"data-value":$optionValue}).appendTo($sodList),$isPlaceholder&&!$sodPrefix?($sod.data("label",$optionText),$sod.data("placeholder",$optionText),$option.prop("disabled",!0),$sodList.find(".sod_option:last").addClass("is-placeholder disabled"),$optionIsSelected&&$sodLabel.addClass("sod_placeholder")):$optionIsSelected&&$sodPlaceholder&&!$sodPlaceholderOption&&!$sodPrefix?$sod.data("label",$sodPlaceholder):$optionIsSelected&&$sod.data("label",$optionText),($optionIsSelected&&!$sodPlaceholder||$optionIsSelected&&$sodPlaceholderOption||$optionIsSelected&&$sodPrefix)&&$sodLabel.append($optionText),$optionParent.is("optgroup")&&($sodList.find(".sod_option:last").addClass("groupchild"),$optionParent.is(":disabled")&&$sodList.find(".sod_option:last").addClass("disabled"))):$("<span/>",{class:"sod_option optgroup "+$optionIsDisabled,title:$optgroupLabel,html:$optgroupLabel,"data-label":$optgroupLabel}).appendTo($sodList)},focusSod:function(){var $sod=$(this);$sod.hasClass("disabled")?_private.blurSod($sod):(_private.blurSod($(".sod_select.focus").not($sod)),$sod.addClass("focus"),$("html").on("click.sodBlur",function(){_private.blurSod($sod)}))},triggerSod:function(e){e.stopPropagation();var $sod=$(this),$sodList=$sod.find(".sod_list"),$sodPlaceholder=$sod.data("placeholder"),$optionActive=$sod.find(".active"),$optionSelected=$sod.find(".selected");$sod.hasClass("disabled")||$sod.hasClass("open")||$sod.hasClass("touch")?(clearTimeout($_sodViewportTimeout),_private.closeSod($sod),$sodPlaceholder&&($sod.find(".sod_label").get(0).lastChild.nodeValue=$optionActive.text())):($sod.addClass("open"),$sodPlaceholder&&!$sod.data("prefix")&&$sod.find(".sod_label").addClass("sod_placeholder").html($sodPlaceholder),_private.listScroll($sodList,$optionSelected.first()),_private.checkViewport($sod,$sodList))},keyboardUse:function(e){var $sod=$(this),$sodList=$sod.find(".sod_list"),$sodOptions=$sod.find(".sod_option"),$sodLabel=$sod.find(".sod_label"),$sodCycle=$sod.data("cycle"),$optionActive=$sodOptions.filter(".active"),$sodFilterHit,$optionNext,$optionCycle;if(e.which>36&&e.which<41)return 37===e.which||38===e.which?($optionNext=$optionActive.prevAll(":not('.disabled, .optgroup')").first(),$optionCycle=$sodOptions.not(".disabled, .optgroup").last()):39!==e.which&&40!==e.which||($optionNext=$optionActive.nextAll(":not('.disabled, .optgroup')").first(),$optionCycle=$sodOptions.not(".disabled, .optgroup").first()),!$optionNext.hasClass("sod_option")&&$sodCycle&&($optionNext=$optionCycle),($optionNext.hasClass("sod_option")||$sodCycle)&&($optionActive.removeClass("active"),$optionNext.addClass("active"),$sodLabel.get(0).lastChild.nodeValue=$optionNext.text(),_private.listScroll($sodList,$optionNext),$sod.hasClass("open")||($_sodKeysWhenClosed=!0)),!1;if(13===e.which||32===e.which&&$sod.hasClass("open")&&(" "===$sod.data("filter")[0]||""===$sod.data("filter"))?(e.preventDefault(),$optionActive.click()):32!==e.which||$sod.hasClass("open")||" "!==$sod.data("filter")[0]&&""!==$sod.data("filter")?27===e.which&&_private.blurSod($sod):(e.preventDefault(),$_sodKeysWhenClosed=!1,$sod.click()),0!==e.which){clearTimeout($_sodFilterTimeout);var searchStr=$sod.data("filter");8==e.which?searchStr=searchStr.substring(0,(searchStr.length||1)-1):searchStr+=String.fromCharCode(e.which).toUpperCase(),searchStr=$.trim(searchStr),$sod.data("filter",searchStr).find(".sod_filter_box").val(searchStr),($sodFilterHit=$sodOptions.filter(function(){var index=$(this).text().toUpperCase().indexOf(searchStr),matches;return matches=!searchStr||!searchStr.match(/\w/is)||($_settings.fuzzyFilter?-1!==index:0===index),$_settings.visualFilter&&$(this).hasClass("hidden")===matches&&$(this)[(matches?"remove":"add")+"Class"]("hidden"),matches}).not(".disabled, .optgroup, .no_results")).length&&($optionActive.removeClass("active"),$sodFilterHit.first().addClass("active"),_private.listScroll($sodList,$sodFilterHit),$sodLabel.get(0).lastChild.nodeValue=_private.getOptionsString($sodFilterHit),$sod.hasClass("open")||($_sodKeysWhenClosed=!0)),$sod.find(".no_results")[($sodFilterHit.length?"add":"remove")+"Class"]("hidden"),$_settings.noFilterTimeout||($_sodFilterTimeout=setTimeout(function(){$sod.data("filter","")},500))}},optionHover:function(){var $option=$(this);$option[0].className.match(/\b(disabled|optgroup|no_results)\b/)||$option.siblings().removeClass("active").end().addClass("active")},getOptionsString:function($sodOptions){return $sodOptions.length>1&&($sodOptions=$sodOptions.not(":disabled").not(".disabled"),$_settings.multiSelect||($sodOptions=$sodOptions.first())),$.map($sodOptions,function(obj){return $(obj).text()}).join(", ")},optionClick:function(e){e.stopPropagation();var bannedClassRegex=new RegExp("\\b(disabled|optgroup|no_results)\\b"),$clicked=$(this),$sod=$clicked.closest(".sod_select"),$ignoreOption=bannedClassRegex.test(this.className),$options,$optionIndex=$sod.find(".sod_option").filter(function(){return!bannedClassRegex.test(this.className)}).index(this);if(!$sod.hasClass("touch")){if(!$ignoreOption){$sod.find(".sod_placeholder").removeClass("sod_placeholder");var $selected=$sod.find(".selected").not($clicked),$nativeOption=$($sod.find("select option")[$optionIndex]),isSelected=$nativeOption.prop("selected");$_settings.multiSelect||!$selected.length||isSelected||($selected.removeClass("selected"),$selected=[]),($_settings.multiSelect||!$selected.length&&!isSelected)&&($nativeOption.prop("selected",!isSelected),$clicked[(isSelected?"remove":"add")+"Class"]("selected")),$sod.find("select").change()}clearTimeout($_sodViewportTimeout),$_settings.multiSelect||_private.closeSod($sod)}},selectChange:function(){var $select=$(this),$optionsSelected=$select.find(":selected"),$optionText=_private.getOptionsString($optionsSelected),$sod=$select.closest(".sod_select");$sod.find(".sod_label").get(0).lastChild.nodeValue=$optionText,$sod.data("label",$optionText),$_settings.onChange.call(this),!$sod.data("links")&&!$optionsSelected.data("link")||$optionsSelected.data("link-external")?($sod.data("links-external")||$optionsSelected.data("link-external"))&&$optionsSelected.each(function(){window.open($(this).val(),"_blank")}):window.location.href=$optionsSelected.first().val()},blurSod:function($sod){if($("body").find($sod).length){var $sodLabel=$sod.data("label"),$sodPlaceholder=$sod.data("placeholder"),$optionActive=$sod.find(".active"),$optionSelected=$sod.find(".selected"),$optionHasChanged=!1;clearTimeout($_sodViewportTimeout),$_sodKeysWhenClosed&&!$optionActive.hasClass("selected")?($optionActive.click(),$optionHasChanged=!0):$optionActive.hasClass("selected")||($optionActive.removeClass("active"),$optionSelected.addClass("active"));var labelString=_private.getOptionsString($optionSelected);$optionHasChanged&&!$optionSelected.length||!$sodPlaceholder?$optionHasChanged||($sod.find(".sod_label").get(0).lastChild.nodeValue=$sodLabel):$sod.find(".sod_label").get(0).lastChild.nodeValue=labelString,$_sodKeysWhenClosed=!1,$sod.removeClass("focus"),_private.closeSod($sod),$sod.blur(),$("html").off(".sodBlur")}},closeSod:function($sod){$sod.removeClass("open").data("filter","").each(function(){$(this).find(".sod_option.hidden").removeClass("hidden")}).each(function(){$(this).find(".sod_option.no_results").addClass("hidden")}).each(function(){$(this).find(".sod_filter_box").val("")})},checkViewport:function($sod,$sodList){var $sodPosition=$sod[0].getBoundingClientRect(),$sodListHeight=$sodList.outerHeight();$sodPosition.bottom+$sodListHeight+10>$(window).height()&&$sodPosition.top-$sodListHeight>10?$sod.addClass("above"):$sod.removeClass("above"),$_sodViewportTimeout=setTimeout(function(){_private.checkViewport($sod,$sodList)},200)},listScroll:function($sodList,$option){var $scrollList=$sodList[0].getBoundingClientRect(),$scrollOption=$option[0].getBoundingClientRect();$scrollList.top>$scrollOption.top?$sodList.scrollTop($sodList.scrollTop()-$scrollList.top+$scrollOption.top):$scrollList.bottom<$scrollOption.bottom&&$sodList.scrollTop($sodList.scrollTop()-$scrollList.bottom+$scrollOption.bottom)},isTouch:function(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0}},methods={destroy:function(){return this.each(function(){var $select=$(this),$sod=$select.parent();$sod.hasClass("sod_select")?($select.off("change"),$sod.find("span").remove(),$select.unwrap()):console.log("Select or Die: There's no SoD to destroy")})},update:function(){return this.each(function(){var $select=$(this),$sod=$select.parent(),$sodList=$sod.find(".sod_list:first");$sod.hasClass("sod_select")?($sodList.empty(),$sod.find(".sod_label").get(0).lastChild.nodeValue="",$select.is(":disabled")&&$sod.addClass("disabled"),$("option, optgroup",$select).each(function(){_private.populateSoD($(this),$sodList,$sod)})):console.log("Select or Die: There's no SoD to update")})},disable:function($value){return this.each(function(){var $select=$(this),$sod=$select.parent();$sod.hasClass("sod_select")?void 0!==$value?($sod.find(".sod_list:first .sod_option[data-value='"+$value+"']").addClass("disabled"),$sod.find(".sod_list:first .sod_option[data-label='"+$value+"']").nextUntil(":not(.groupchild)").addClass("disabled"),$("option[value='"+$value+"'], optgroup[label='"+$value+"']",this).prop("disabled",!0)):$sod.hasClass("sod_select")&&($sod.addClass("disabled"),$select.prop("disabled",!0)):console.log("Select or Die: There's no SoD to disable")})},enable:function($value){return this.each(function(){var $select=$(this),$sod=$select.parent();$sod.hasClass("sod_select")?void 0!==$value?($sod.find(".sod_list:first .sod_option[data-value='"+$value+"']").removeClass("disabled"),$sod.find(".sod_list:first .sod_option[data-label='"+$value+"']").nextUntil(":not(.groupchild)").removeClass("disabled"),$("option[value='"+$value+"'], optgroup[label='"+$value+"']",this).prop("disabled",!1)):$sod.hasClass("sod_select")&&($sod.removeClass("disabled"),$select.prop("disabled",!1)):console.log("Select or Die: There's no SoD to enable")})}};return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error('Select or Die: Oh no! No such method "'+method+'" for the SoD instance'):_private.initSoD.apply(this,arguments)}}(jQuery);